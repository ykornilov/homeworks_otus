# Домашнее задание занятия NodeJS в Production

## Запуск

Запуск сервера:
```
npm start
```
Сервер доступен по url: `http://localhost:3000`

## Сравнение разных режимов запуска

1. Без кластеризации и без pm2:
- `get`-запрос на получение страницы  
Running 10s test @ http://localhost:3000  
1000 connections
```
┌─────────┬────────┬─────────┬─────────┬─────────┬────────────┬───────────┬────────────┐
│ Stat    │ 2.5%   │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max        │
├─────────┼────────┼─────────┼─────────┼─────────┼────────────┼───────────┼────────────┤
│ Latency │ 139 ms │ 1813 ms │ 2336 ms │ 2458 ms │ 1684.89 ms │ 482.88 ms │ 2534.47 ms │
└─────────┴────────┴─────────┴─────────┴─────────┴────────────┴───────────┴────────────┘
┌───────────┬─────────┬─────────┬────────┬────────┬────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%    │ 97.5%  │ Avg    │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼────────┼────────┼────────┼─────────┼─────────┤
│ Req/Sec   │ 213     │ 213     │ 551    │ 662    │ 544.71 │ 118.43  │ 213     │
├───────────┼─────────┼─────────┼────────┼────────┼────────┼─────────┼─────────┤
│ Bytes/Sec │ 88.4 kB │ 88.4 kB │ 229 kB │ 275 kB │ 226 kB │ 49.1 kB │ 88.4 kB │
└───────────┴─────────┴─────────┴────────┴────────┴────────┴─────────┴─────────┘
```
    5k requests in 10.16s, 2.26 MB read

- `post`-запрос, выполняющийся около 2 секунд:  
Running 10s test @ http://localhost:3000/task  
1000 connections
```
┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬────────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max        │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼────────────┤
│ Latency │ 2007 ms │ 2077 ms │ 3302 ms │ 3317 ms │ 2202.02 ms │ 326.37 ms │ 3461.43 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴────────────┘
┌───────────┬─────┬──────┬─────────┬────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50%     │ 97.5%  │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 301     │ 699    │ 400     │ 267.74  │ 301     │
├───────────┼─────┼──────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 66.9 kB │ 155 kB │ 88.8 kB │ 59.4 kB │ 66.8 kB │
└───────────┴─────┴──────┴─────────┴────────┴─────────┴─────────┴─────────┘
```
    4k requests in 10.21s, 888 kB read

2. При использовании кластеризации (12 процессов):
- `get`-запрос на получение страницы  
Running 10s test @ http://localhost:3000  
1000 connections
```
┌─────────┬────────┬────────┬─────────┬─────────┬───────────┬───────────┬────────────┐
│ Stat    │ 2.5%   │ 50%    │ 97.5%   │ 99%     │ Avg       │ Stdev     │ Max        │
├─────────┼────────┼────────┼─────────┼─────────┼───────────┼───────────┼────────────┤
│ Latency │ 274 ms │ 485 ms │ 1331 ms │ 1543 ms │ 535.26 ms │ 229.63 ms │ 1845.57 ms │
└─────────┴────────┴────────┴─────────┴─────────┴───────────┴───────────┴────────────┘
┌───────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%  │ Avg    │ Stdev  │ Min    │
├───────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┤
│ Req/Sec   │ 270    │ 270    │ 2025   │ 2305   │ 1834.9 │ 584.97 │ 270    │
├───────────┼────────┼────────┼────────┼────────┼────────┼────────┼────────┤
│ Bytes/Sec │ 112 kB │ 112 kB │ 841 kB │ 956 kB │ 761 kB │ 243 kB │ 112 kB │
└───────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┘
```
    18k requests in 10.28s, 7.61 MB read


- `post`-запрос, выполняющийся около 2 секунд:  
Running 10s test @ http://localhost:3000/task  
1000 connections
```
┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬───────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max       │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼───────────┤
│ Latency │ 2001 ms │ 2019 ms │ 3142 ms │ 3174 ms │ 2112.06 ms │ 218.07 ms │ 3187.7 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴───────────┘
┌───────────┬─────┬──────┬─────────┬────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%  │ 2.5% │ 50%     │ 97.5%  │ Avg     │ Stdev   │ Min     │
├───────────┼─────┼──────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 0   │ 0    │ 120     │ 880    │ 400     │ 394.37  │ 120     │
├───────────┼─────┼──────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 26.7 kB │ 195 kB │ 88.8 kB │ 87.6 kB │ 26.6 kB │
└───────────┴─────┴──────┴─────────┴────────┴─────────┴─────────┴─────────┘
```
    4k requests in 10.22s, 888 kB read


3. При использовании pm2 (12 процессов):
- `get`-запрос на получение страницы  
Running 10s test @ http://localhost:3000  
1000 connections
```
┌─────────┬────────┬────────┬─────────┬─────────┬───────────┬───────────┬────────────┐
│ Stat    │ 2.5%   │ 50%    │ 97.5%   │ 99%     │ Avg       │ Stdev     │ Max        │
├─────────┼────────┼────────┼─────────┼─────────┼───────────┼───────────┼────────────┤
│ Latency │ 251 ms │ 369 ms │ 1018 ms │ 1198 ms │ 404.85 ms │ 162.04 ms │ 1404.22 ms │
└─────────┴────────┴────────┴─────────┴─────────┴───────────┴───────────┴────────────┘
┌───────────┬────────┬────────┬────────┬─────────┬─────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%   │ Avg     │ Stdev  │ Min    │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼────────┼────────┤
│ Req/Sec   │ 500    │ 500    │ 2657   │ 2905    │ 2442.1  │ 713.47 │ 500    │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼────────┼────────┤
│ Bytes/Sec │ 208 kB │ 208 kB │ 1.1 MB │ 1.21 MB │ 1.01 MB │ 296 kB │ 208 kB │
└───────────┴────────┴────────┴────────┴─────────┴─────────┴────────┴────────┘
```
    24k requests in 10.26s, 10.1 MB read


- `post`-запрос, выполняющийся около 2 секунд:  
Running 10s test @ http://localhost:3000/task  
1000 connections
```
┌─────────┬─────────┬─────────┬─────────┬─────────┬────────────┬───────────┬────────────┐
│ Stat    │ 2.5%    │ 50%     │ 97.5%   │ 99%     │ Avg        │ Stdev     │ Max        │
├─────────┼─────────┼─────────┼─────────┼─────────┼────────────┼───────────┼────────────┤
│ Latency │ 2002 ms │ 2017 ms │ 2367 ms │ 2378 ms │ 2097.33 ms │ 144.27 ms │ 2399.67 ms │
└─────────┴─────────┴─────────┴─────────┴─────────┴────────────┴───────────┴────────────┘
┌───────────┬─────┬──────┬─────┬────────┬─────────┬────────┬────────┐
│ Stat      │ 1%  │ 2.5% │ 50% │ 97.5%  │ Avg     │ Stdev  │ Min    │
├───────────┼─────┼──────┼─────┼────────┼─────────┼────────┼────────┤
│ Req/Sec   │ 0   │ 0    │ 0   │ 1000   │ 400     │ 489.9  │ 1000   │
├───────────┼─────┼──────┼─────┼────────┼─────────┼────────┼────────┤
│ Bytes/Sec │ 0 B │ 0 B  │ 0 B │ 222 kB │ 88.8 kB │ 109 kB │ 222 kB │
└───────────┴─────┴──────┴─────┴────────┴─────────┴────────┴────────┘
```
    4k requests in 10.22s, 888 kB read